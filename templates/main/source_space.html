{% extends "layout.html" %}
{% load static %}

{% block script %}
    <script src="{% static 'js/source_space.js' %}"></script>
{% endblock %}

{% block title %}
    {{ source }}
{% endblock %}

{% block header %}
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'work_space:space_view' source.work_space.pk %}" class="color-grey">{{ source.work_space }}</a></li>
            <li class="breadcrumb-item active light-blue" aria-current="page">
                <h2 class="one-liner light-blue">"{{ source }}" by {{ source.author }}&nbsp;<i id="edit-title-symbol" class="fa-solid fa-pen-to-square fa-xs" style="display: none;"></i></h2>
            </li>
        </ol>
    </nav>
{% endblock %}

{% block nav_links %}
    <nav class="nav-tabs" id="nav-tabs">
        <a onclick="show_source_area('info-area');return false" href="#" type="button" class="active">
            Info
        </a>
        <a onclick="show_source_area('actions-area');return false" href="#" type="button" id="settings-area-button">
            Actions
        </a>
    </nav>
{% endblock %}

{% block body %}
    <div class="source-area" id="info-area">


        <h2>Info area</h2>





    </div>
    <div class="source-area" id="actions-area" style="display: none;">
        <div class="cards-row">
            <!-- Add Source Link Card -->
            <div class="card mb-3 transparent-card" style="max-width: 540px;">
                <div class="row g-0">
                    <div class="col-md-4">
                        <img src="/static/images/flat_icons/source/source_link.png" class="img-fluid rounded-start" alt="Add Link">
                    </div>
                    <div class="col-md-8">
                        <div class="card-body">
                            <h5 class="card-title">
                                {% if source.link %}
                                    <b>Add New Link</b>
                                {% else %}
                                    <b>Add Link to Source</b>
                                {% endif %}
                            </h5>
                            <p class="card-text">
                                <br>Click below to add a link:<br>
                                <a href="#add-link-modal" class="open-modal-button light-blue" data-bs-toggle="modal" data-bs-target="#add-link-modal">
                                    You will no longer need to find "{{ source }}"
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Upload Source File Card -->
            <div class="card mb-3 transparent-card right-card" style="max-width: 540px;">
                <div class="row g-0">
                    <div class="col-md-4">
                        <img src="/static/images/flat_icons/source/source_file.png" class="img-fluid rounded-start" alt="Upload File">
                    </div>
                    <div class="col-md-8">
                        <div class="card-body">
                            <h5 class="card-title">
                                {% if source.has_file %}
                                    Upload New File
                                {% else %}
                                    Upload Source file
                                {% endif %}
                            </h5>
                            <p class="card-text">
                                <br>Upload .docx / .pdf file here:<br>
                                <a href="#upload-source-file-modal" class="open-modal-button light-blue" data-bs-toggle="modal" data-bs-target="#upload-source-file-modal">
                                    Save {{ source }}!
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div><br><br>
        <div class="cards-row">
            <!-- Alter Source Info Card -->
            <div class="card mb-3 transparent-card" style="max-width: 540px;">
                <div class="row g-0">
                    <div class="col-md-4">
                        <img src="/static/images/flat_icons/source/alter_source.png" class="img-fluid rounded-start" alt="Alter Info">
                    </div>
                    <div class="col-md-8">
                        <div class="card-body">
                            <h5 class="card-title">Alter Source Info</h5>
                            <p class="card-text">
                                <br>Change source title, author or anything else you'd like:<br>
                                <a href="#alter-source-modal" class="open-modal-button light-blue" data-bs-toggle="modal" data-bs-target="#alter-source-modal">
                                    Open Source Settings
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Delete Source Card -->
            <div class="card mb-3 transparent-card right-card" style="max-width: 540px;">
                <div class="row g-0">
                    <div class="col-md-4">
                        <img src="/static/images/flat_icons/source/delete_source.png" class="img-fluid rounded-start" alt="Delete Source">
                    </div>
                    <div class="col-md-8">
                        <div class="card-body">
                            <h5 class="card-title">Delete Source</h5>
                            <p class="card-text">
                                <br>Click here at your own risk:<br>
                                <a href="#delete-source-modal" class="open-modal-button color-red" data-bs-toggle="modal" data-bs-target="#delete-source-modal">
                                    Delete Source Forever!
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Add Source Link Modal -->
        <div class="modal fade" id="add-link-modal" tabindex="-1" aria-labelledby="add-link-modal-label" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="add-link-modal-label">Add link to your source here</h1>
                        <button type="button" class="btn-close close-header-button" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form action="{% url 'bookshelf:add_link' source.pk %}" method="post" class="needs-validation" novalidate>
                            {% csrf_token %}
                            <div class="form-outline mb-4 form-floating">
                                {{ link_form.link }}
                                <label class="form-label" for="link-field">Link</label>
                                <div class="valid-feedback">Looks good!</div>
                                <div class="invalid-feedback">Please provide a link.</div>
                            </div>
                            <div class="d-flex justify-content-center">
                                <input type="submit" value="Add" class="btn btn-info btn-lg btn-block gradient-custom-4 text-body"></input>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary close-footer-button" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Upload Source File Modal -->
        <div class="modal fade" id="upload-source-file-modal" tabindex="-1" aria-labelledby="upload-source-file-modal-label" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="upload-source-file-modal-label">Upload .docx / .pdf file here</h1>
                        <button type="button" class="btn-close close-header-button" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form enctype="multipart/form-data" action="{% url 'file_handling:upload_source_file' source.pk %}" method="post" class="needs-validation" novalidate>
                            {% csrf_token %} 
                            <div class="mb-3">
                                {{ upload_file_form.file }}
                            </div>
                            <div class="d-flex justify-content-center">
                                <input type="submit" value="Upload" class="btn btn-info btn-lg btn-block gradient-custom-4 text-body"></input>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary close-footer-button" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Alter Source Info Modal -->
        <div class="modal fade" id="alter-source-modal" tabindex="-1" aria-labelledby="alter-source-modal-label" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title fs-5" id="alter-source-modal-label">Source Settings</h1>
                        <button type="button" class="btn-close close-header-button" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form action="{% url 'bookshelf:alter_source' source.pk %}" method="post" class="needs-validation" novalidate>
                            {% csrf_token %}
                            <div class="form-outline mb-4 form-floating">
                                {{ link_form.link }}
                                <label class="form-label" for="link-field">Link</label>
                                <div class="valid-feedback">Looks good!</div>
                                <div class="invalid-feedback">Please provide a link.</div>
                            </div>
                            <div class="d-flex justify-content-center">
                                <input type="submit" value="Edit Source" class="btn btn-info btn-lg btn-block gradient-custom-4 text-body"></input>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary close-footer-button" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

       


    </div>
{% endblock %}
